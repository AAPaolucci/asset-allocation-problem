---
title: "Asset-allocation"
author: "Arthur Paolucci, Felipe Nascimbeni Cosi, Carlos Tiburcio, Ignacio Bergallo"
date: "02/10/2020"
output:
  html_document: default
  word_document: default
---

```{r setup, include=F}
chooseCRANmirror(graphics=FALSE, ind=1)
knitr::opts_chunk$set(echo = TRUE)
```

```{r cabeçalho, echo = F, evaluate = T, message = F, warning = F, include = F}
## Asset Allocation Problem
# Este código tem o objetivo de estimar a alocação do fundo de investimentos multimercados JGP Strategy Master na janela de tempo definida.
```

```{r limpeza de memória, include = F}
rm(list = ls())
```

```{r definindo as opções, include = FALSE}
options(OutDec = ".", round = 2, digits = c(5,2))
```

```{r pacotes, echo = T, eval = T, message = T, warning = T, include = F}
# Pacotes populares: readxl, dplyr, tidyr, stringr, lubridate, plotly, dygraphs, data.table, tibble, zoo, xts, quantmod, BETs, sidrar, car. 
packset = c("readxl","tidyr","dplyr","lubridate","xts","PerformanceAnalytics","plotly","dygraphs","dplyr", "quadprog", "car")
not_inst <- packset[!(packset %in% installed.packages()[,"Package"])]
if(length(not_inst)) install.packages(not_inst)
lapply(packset, require, character.only = TRUE)
```

# Asset Allocation Problem

### 1. Problema

Este trabalho tem por objetivo estimar, dada uma janela de tempo, a alocação de um fundo de investimentos multimercado no Brasil, ou seja, determinar a exposição da sua carteira a diferentes fatores de risco. A motivação para tal, se dá pelo fato de que a Comissão de Valores Mobiliários (CVM) divulga a alocação dos fundos depois de um período de três meses, enquanto o mercado precisa saber como os fundos estão posicionados no momento da decisão de investimento.

### 2. Revisão Bibliográfica

É amplamente conhecido que os retornos de uma carteira ou portfólio de mercado estão relacionados com diferentes fatores de risco. Observa-se na literatura a utilização de modelos de múltiplos fatores para medir e administrar a exposição a esses riscos. Esses fatores podem ser, por exemplo, indicadores macroeconômicos como taxa de juros, taxa de inflação, índices de preços de mercados internos ou externos, etc.

Existe um consenso de que a alocação em classes de ativos é a principal responsável pela variação nos retornos de uma carteira de investimentos. Isso é especialmente verdade se essa carteira é bem diversificada, ou seja, investe em vários fundos, que por sua vez investem em vários ativos.

Os fatores de risco utilizados neste trabalho foram obtidos a partir da “tropicalização” dos fatores utilizados por Sharpe na sua publicação “Asset Allocation: Management Style and Performance Measurement”. 
Em seu trabalho, o autor busca estimar o “estilo” (alocação em classes de ativos) de diferentes fundos a partir do seguinte modelo de fatores:

 $$(1) R_i = [b_{i1}\tilde{F_1}+b_{i2}\tilde{F_2}+...+b_{in}\tilde{F_n}] + \tilde{e_i}$$

Neste modelo, cada fator representa o retorno de uma classe de ativos e interpreta-se os coeficientes como a sensibilidade da carteira aos fatores de risco escolhidos. É importante destacar que os coeficientes devem somar 1 (ou 100%), já que o retorno de cada ativo investido pelo fundo pode ser decomposto nos fatores de risco e o retorno do fundo deve ser explicado pela soma dos retornos de todos os ativos investidos por ele.

De fato, a soma dos termos em chaves na equação 1 pode ser interpretada como o retorno atribuído à escolha das classes de ativo a que o fundo está exposto, enquanto o resíduo pode ser explicado como o retorno atribuído à seleção de ativos. Apesar de somarem 100%, os coeficientes não devem ser confundidos com os pesos de uma carteira, já que os fatores representam diferentes riscos e não ativos.

**Sugestão AP:**
**> Explicar a seleção (“tropicalização”) dos fatores **

**(Tabela tropicalização - sugestão: comparar escolhas do sharpe com as nossas)**

**> Explicar a escolha de janelas de 70 dias e dos períodos selecionados**

### 3. Base de Dados

Todos os dados utilizados neste trabalho foram obtidos na base Economática, acessível para os alunos da FGV, ou calculados a partir da base. Na plataforma, é possível obter o histórico de preços da cota de fundos de investimento e ainda de diversos indicadores de mercado. Os dados obtidos na plataforma foram exportados para uma planilha e, em seguida, importados para o R. No programa em R, foram realizados procedimentos de limpeza e organização dos dados e foram calculados os retornos para cada variável utilizada no modelo pelo método dos retornos logarítmicos. A tabela abaixo descreve as variáveis presentes na base de dados utilizada:

Atributo|Descrição|Base/ Calculado|Fonte/ Cálculo|Papel na Regressão|Tipo|Domínio
--------|--------|--------|--------|--------|--------|--------|--------
Cota|Preço da cota do fundo "Verde..." em reais a.d.|Base|Economática|-|Numérico|$\Re+$


#### Importando os dados da Economatica

A FGV disponibiliza aos alunos o acesso à base de dados economatica. Para esse trabalho temos o interesse em obter as cotações do fundo analisado (JGP Strategy...) e dos índices que servirão como proxy para os fatores de risco.

Entretanto, para trabalhar esse conjunto de dados como cross-sectional devemos utilizar os retornos ao invés dos níveis de preço.

```{r database, echo = F, eval = T, include = F}
# Importar planilhas excel para cada conjunto de dados (readxl)
verde <-  read_xlsx('database.xlsx',sheet='VERDE', skip=3, col_names=T)
ibov <- read_xlsx('database.xlsx',sheet='IBOV', skip=3, col_names=T)
snp <- read_xlsx('database.xlsx',sheet='S&P 500', skip=3, col_names=T)
imab5 <- read_xlsx('database.xlsx',sheet='IMA-B 5', skip=3, col_names=T)
imab5p <- read_xlsx('database.xlsx',sheet='IMA-B 5+', skip=3, col_names=T)
dolar <- read_xlsx('database.xlsx',sheet='DOLX20', skip=3, col_names=T)
di17 <- read_xlsx('database.xlsx',sheet='DI1N17', skip=3, col_names=T)
di19 <- read_xlsx('database.xlsx',sheet='DI1N19', skip=3, col_names=T)
di21 <- read_xlsx('database.xlsx',sheet='DI1N21', skip=3, col_names=T)
di23 <- read_xlsx('database.xlsx',sheet='DI1N23', skip=3, col_names=T)
di25 <- read_xlsx('database.xlsx',sheet='DI1N25', skip=3, col_names=T)

# Transformar em timeseries object
verde <- as.xts(verde[,'Cota'],order.by = verde$Data)
ibov <- as.xts(ibov[,'Fechamento'],order.by = ibov$Data)
snp <- as.xts(snp[,'Fechamento'],order.by = snp$Data)
imab5 <- as.xts(imab5[,'Fechamento'],order.by = imab5$Data)
imab5p <- as.xts(imab5p[,'Fechamento'],order.by = imab5p$Data)
dolar <- as.xts(dolar[,'Fechamento'],order.by = dolar$Data)
di17 <- as.xts(di17[,'Fechamento'],order.by = di17$Data)
di19 <- as.xts(di19[,'Fechamento'],order.by = di19$Data)
di21 <- as.xts(di21[,'Fechamento'],order.by = di21$Data)
di23 <- as.xts(di23[,'Fechamento'],order.by = di23$Data)
di25 <- as.xts(di25[,'Fechamento'],order.by = di25$Data)

# Converter '-' para NA
verde <- na_if(verde$Cota,"-")
ibov <- na_if(ibov$Fechamento,"-")
snp <- na_if(snp$Fechamento,"-")
imab5 <- na_if(imab5$Fechamento,"-")
imab5p <- na_if(imab5p$Fechamento,"-")
dolar <- na_if(dolar$Fechamento,"-")
di17 <- na_if(di17$Fechamento,"-")
di19 <- na_if(di19$Fechamento,"-")
di21 <- na_if(di21$Fechamento,"-")
di23 <- na_if(di23$Fechamento,"-")
di25 <- na_if(di25$Fechamento,"-")

# Merge xts
dat <- merge.zoo(verde, ibov, snp, imab5, imab5p, dolar, 
                 di17, di19, di21, di23, di25,
                 fill=NA, all=T, 
                 suffixes=c('verde', 'ibov', 'snp',
                            'imab5', 'imab5p', 'dolar',
                            'di17', 'di19', 'di21', 'di23', 'di25'))

## Solução para dias úteis descasados: repetir última observação
dat <- na.locf(dat)

# Converter dados para numericos
storage.mode(dat) <- "numeric"



# Calcular os retornos (Performance Analytics)
dat$Ret.verde <- Return.calculate(dat$Cota,
                          method = "log")%>%na.omit()
dat$Ret.ibov <- Return.calculate(dat$Fechamento.ibov,
                          method = "log")%>%na.omit()
dat$Ret.snp <- Return.calculate(dat$Fechamento.snp,
                          method = "log")%>%na.omit()
dat$Ret.imab5 <- Return.calculate(dat$Fechamento.imab5,
                          method = "log")%>%na.omit()
dat$Ret.imab5p <- Return.calculate(dat$Fechamento.imab5p,
                          method = "log")%>%na.omit()
dat$Ret.dolar <- Return.calculate(dat$Fechamento.dolar,
                          method = "log")%>%na.omit()
dat$Ret.di17 <- Return.calculate(dat$Fechamento.di17,
                          method = "log")%>%na.omit()
dat$Ret.di19 <- Return.calculate(dat$Fechamento.di19,
                          method = "log")%>%na.omit()
dat$Ret.di21 <- Return.calculate(dat$Fechamento.di21,
                          method = "log")%>%na.omit()
dat$Ret.di23 <- Return.calculate(dat$Fechamento.di23,
                          method = "log")%>%na.omit()
dat$Ret.di25 <- Return.calculate(dat$Fechamento.di25,
                          method = "log")%>%na.omit()
```

```{r janelas, echo = T, eval = T, include = T}
# Selecionar janelas de interesse
index(dat) <- as.Date(index(dat))

## Janela 1: janela de 70 dias até 2016-07-01
end_date <- index(dat[index(dat)>='2016-07-01',][1,])
start_date <- index(dat)[match(end_date,index(dat))-69]
jan1 <- window(dat, start = start_date, end = end_date)
str(jan1)

## Janela 2: janela de 70 dias até 2018-07-01
end_date <- index(dat[index(dat)>='2018-07-01',][1,])
start_date <- index(dat)[match(end_date,index(dat))-69]
jan2 <- window(dat, start = start_date, end = end_date)
str(jan2)

## Janela 3: janela de 70 dias até 2020-07-01
end_date <- index(dat[index(dat)>='2020-07-01',][1,])
start_date <- index(dat)[match(end_date,index(dat))-69]
jan3 <- window(dat, start = start_date, end = end_date)
str(jan3)
```


```{r statisticas, echo = T, eval = T, include = F}
#Para c/ janela de tempo de cada fator calculamos as estatiscas descritivas.

## Janela 1:

media1 <- with(jan1, cbind(mean(Ret.verde), mean(Ret.ibov), mean(Ret.snp), mean(Ret.imab5), mean(Ret.imab5p), mean(Ret.dolar), mean(Ret.di17), mean(Ret.di21)))

ep1 <- with(jan1, cbind(sd(Ret.verde), sd(Ret.ibov), sd(Ret.snp), sd(Ret.imab5), sd(Ret.imab5p), sd(Ret.dolar), sd(Ret.di17), sd(Ret.di21)))

skew1 <- with(jan1, cbind(skewness(Ret.verde), skewness(Ret.ibov), skewness(Ret.snp), skewness(Ret.imab5), skewness(Ret.imab5p), skewness(Ret.dolar), skewness(Ret.di17), skewness(Ret.di21)))

kurt1 <- with(jan1, cbind(kurtosis(Ret.verde), kurtosis(Ret.ibov), kurtosis(Ret.snp), kurtosis(Ret.imab5), kurtosis(Ret.imab5p), kurtosis(Ret.dolar), kurtosis(Ret.di17), kurtosis(Ret.di21)))

corr1 <- with(jan1, cbind(cor(Ret.verde,Ret.verde), cor(Ret.verde,Ret.ibov), cor(Ret.verde,Ret.snp), cor(Ret.verde,Ret.imab5), cor(Ret.verde,Ret.imab5p), cor(Ret.verde,Ret.dolar), cor(Ret.verde,Ret.di17), cor(Ret.verde,Ret.di21)))

## Janela 2:
media2 <- with(jan2, cbind(mean(Ret.verde), mean(Ret.ibov), mean(Ret.snp), mean(Ret.imab5), mean(Ret.imab5p), mean(Ret.dolar), mean(Ret.di19), mean(Ret.di23)))

ep2 <- with(jan2, cbind(sd(Ret.verde), sd(Ret.ibov), sd(Ret.snp), sd(Ret.imab5), sd(Ret.imab5p), sd(Ret.dolar), sd(Ret.di19), sd(Ret.di23)))

skew2 <- with(jan2, cbind(skewness(Ret.verde), skewness(Ret.ibov), skewness(Ret.snp), skewness(Ret.imab5), skewness(Ret.imab5p), skewness(Ret.dolar), skewness(Ret.di19), skewness(Ret.di23)))

kurt2 <- with(jan2, cbind(kurtosis(Ret.verde), kurtosis(Ret.ibov), kurtosis(Ret.snp), kurtosis(Ret.imab5), kurtosis(Ret.imab5p), kurtosis(Ret.dolar), kurtosis(Ret.di19), kurtosis(Ret.di23)))

corr2 <- with(jan2, cbind(cor(Ret.verde,Ret.verde), cor(Ret.verde,Ret.ibov), cor(Ret.verde,Ret.snp), cor(Ret.verde,Ret.imab5), cor(Ret.verde,Ret.imab5p), cor(Ret.verde,Ret.dolar), cor(Ret.verde,Ret.di19), cor(Ret.verde,Ret.di23)))

## Janela 3:

media3 <- with(jan3, cbind(mean(Ret.verde), mean(Ret.ibov), mean(Ret.snp), mean(Ret.imab5), mean(Ret.imab5p), mean(Ret.dolar), mean(Ret.di21), mean(Ret.di25)))

ep3 <- with(jan3, cbind(sd(Ret.verde), sd(Ret.ibov), sd(Ret.snp), sd(Ret.imab5), sd(Ret.imab5p), sd(Ret.dolar), sd(Ret.di21), sd(Ret.di25)))

skew3 <- with(jan3, cbind(skewness(Ret.verde), skewness(Ret.ibov), skewness(Ret.snp), skewness(Ret.imab5), skewness(Ret.imab5p), skewness(Ret.dolar), skewness(Ret.di21), skewness(Ret.di25)))

kurt3 <- with(jan3, cbind(kurtosis(Ret.verde), kurtosis(Ret.ibov), kurtosis(Ret.snp), kurtosis(Ret.imab5), kurtosis(Ret.imab5p), kurtosis(Ret.dolar), kurtosis(Ret.di21), kurtosis(Ret.di25)))

corr3 <- with(jan3, cbind(cor(Ret.verde,Ret.verde), cor(Ret.verde,Ret.ibov), cor(Ret.verde,Ret.snp), cor(Ret.verde,Ret.imab5), cor(Ret.verde,Ret.imab5p), cor(Ret.verde,Ret.dolar), cor(Ret.verde,Ret.di21), cor(Ret.verde,Ret.di25)))
```

Os fatores “tropicalizados” utilizados no modelo são as taxas de retorno calculadas, dessa forma a hipótese de independência entre as observações da amostra aleatória do método de mínimos quadrados ordinários não é violada. No Item 4.3. a validade dessa hipótese é analisada em detalhe. As tabelas abaixo apresentam as estatísticas descritivas, para cada janela, de cada variável incluída no modelo de fatores:

**Estatisticas Janela 1:**

Fator| Mean| Standard Deviation| Skewness| Kurtosis| Corr(Ret.verde)
------------- | -------------| -------------| -------------| -------------| -------------
Ret.verde | `r  media1[,1]`|`r  ep1[,1]`|`r  skew1[,1]`|`r  kurt1[,1]`| `r  corr1[,1]`
Ret.ibov | `r  media1[,2]`|`r  ep1[,2]`|`r  skew1[,2]`|`r  kurt1[,2]`| `r  corr1[,2]`
Ret.snp | `r  media1[,3]`|`r  ep1[,3]`|`r  skew1[,3]`|`r  kurt1[,3]`| `r  corr1[,3]`
Ret.imab5 | `r  media1[,4]`|`r  ep1[,4]`|`r  skew1[,4]`|`r  kurt1[,4]`| `r  corr1[,4]`
Ret.imab5p | `r  media1[,5]`|`r  ep1[,5]`|`r  skew1[,5]`|`r  kurt1[,5]`| `r  corr1[,5]`
Ret.dolar | `r  media1[,6]`|`r  ep1[,6]`|`r  skew1[,6]`|`r  kurt1[,6]`| `r  corr1[,6]`
Ret.di17 | `r  media1[,7]`|`r  ep1[,7]`|`r  skew1[,7]`|`r  kurt1[,7]`| `r  corr1[,7]`
Ret.di21 | `r  media1[,8]`|`r  ep1[,8]`|`r  skew1[,8]`|`r  kurt1[,8]`| `r  corr1[,8]`

**Estatisticas Janela 2:**

Fator| Mean| Standard Deviation| Skewness| Kurtosis| Corr(Ret.verde)
------------- | -------------| -------------| -------------| -------------| -------------
Ret.verde | `r  media2[,1]`|`r  ep2[,1]`|`r  skew2[,1]`|`r  kurt2[,1]`| `r  corr2[,1]`
Ret.ibov | `r  media2[,2]`|`r  ep2[,2]`|`r  skew2[,2]`|`r  kurt2[,2]`| `r  corr2[,2]`
Ret.snp | `r  media2[,3]`|`r  ep2[,3]`|`r  skew2[,3]`|`r  kurt2[,3]`| `r  corr2[,3]`
Ret.imab5 | `r  media2[,4]`|`r  ep2[,4]`|`r  skew2[,4]`|`r  kurt2[,4]`| `r  corr2[,4]`
Ret.imab5p | `r  media2[,5]`|`r  ep2[,5]`|`r  skew2[,5]`|`r  kurt2[,5]`| `r  corr2[,5]`
Ret.dolar | `r  media2[,6]`|`r  ep2[,6]`|`r  skew2[,6]`|`r  kurt2[,6]`| `r  corr2[,6]`
Ret.di19 | `r  media2[,7]`|`r  ep2[,7]`|`r  skew2[,7]`|`r  kurt2[,7]`| `r  corr2[,7]`
Ret.di23 | `r  media2[,8]`|`r  ep2[,8]`|`r  skew2[,8]`|`r  kurt2[,8]`| `r  corr2[,8]`

**Estatisticas Janela 3:**

Fator| Mean| Standard Deviation| Skewness| Kurtosis| Corr(Ret.verde)
------------- | -------------| -------------| -------------| -------------| -------------
Ret.verde | `r  media3[,1]`|`r  ep3[,1]`|`r  skew3[,1]`|`r  kurt3[,1]`| `r  corr3[,1]`
Ret.ibov | `r  media3[,2]`|`r  ep3[,2]`|`r  skew3[,2]`|`r  kurt3[,2]`| `r  corr3[,2]`
Ret.snp | `r  media3[,3]`|`r  ep3[,3]`|`r  skew3[,3]`|`r  kurt3[,3]`| `r  corr3[,3]`
Ret.imab5 | `r  media3[,4]`|`r  ep3[,4]`|`r  skew3[,4]`|`r  kurt3[,4]`| `r  corr3[,4]`
Ret.imab5p | `r  media3[,5]`|`r  ep3[,5]`|`r  skew3[,5]`|`r  kurt3[,5]`| `r  corr3[,5]`
Ret.dolar | `r  media3[,6]`|`r  ep3[,6]`|`r  skew3[,6]`|`r  kurt3[,6]`| `r  corr3[,6]`
Ret.di21 | `r  media3[,7]`|`r  ep3[,7]`|`r  skew3[,7]`|`r  kurt3[,7]`| `r  corr3[,7]`
Ret.di25 | `r  media3[,8]`|`r  ep3[,8]`|`r  skew3[,8]`|`r  kurt3[,8]`| `r  corr3[,8]`



```{r histograma, echo = F, eval = T, include = F}
# Histogramas dos retornos
## Vale fazer um facet grid dos retornos?
his <- jan1 %>%
    ggplot(aes(x=Ret.ibov)) +
        geom_histogram(binwidth=0.01, fill="#69b3a2", 
                       color="#e9ecef", alpha=0.9) +
        xlab("Daily Returns") +
        ylab("Frequency")
his
```

```{r , echo = F, eval = T, include = F}
# Histogramas dos retornos
## Vale fazer um facet grid dos retornos?
### eu acho melhor para mostrar que a media do erro é zero utilizar os residuos.
his <- jan1 %>%
    ggplot(aes(x=Ret.ibov)) +
        geom_histogram(binwidth=0.01, fill="#69b3a2", 
                       color="#e9ecef", alpha=0.9) +
        xlab("Daily Returns") +
        ylab("Frequency")
his
```
### 4 Metodologia (OLS)

Cochrane (p. 435, 2005) explica que os retornos podem ser observados como um conjunto de dados “cross section” ou dados em séries temporais, dependendo da pergunta que se queira responder. Neste caso, estuda-se o nível de retorno dado certos fatores de risco num instante t, dito isso é adequado o uso do método clássico de OLS para obter os coeficientes dos fatores do modelo.

A seguir, vamos escrever o modelo a estimar pelo método de OLS, calculamos a regressão linear para cada janela de tempo e vemos se são cumpridas as propriedades algébricas dos estimadores de OLS para que sejam aceitas como certas as hipóteses de Gauss-Markov.


#### 4.1 Relação Linear (nos coeficientes)

O modelo populacional é descrito como:

$$ ret.verde = \beta_1ret.ibov+\beta_2ret.snp+\beta_3ret.imab5+\beta_4ret.imab5p+\beta_5 ret.dolar+\beta_6ret.di_{1ano}+\beta_7ret.di_{3anos}+\mu$$
O modelo é linear nos parâmetros, vamos estimar os coeficientes do modelo utilizando os estimadores de OLS.

```{r regres, echo = T, eval = T, include = T}
# Regressão linear OLS
## Regressão da janela 1 (2016)
regres1 <- lm(Ret.verde~Ret.ibov+Ret.snp+Ret.imab5+Ret.imab5p+
               Ret.dolar+Ret.di17+Ret.di21, data=jan1)
b1.hat<-coef(regres1) #coeficientes
regres1.hat<-fitted(regres1) #retorno previsto
u1.hat<-resid(regres1) #residuos
summary(regres1)

## Regressão da janela 2 (2018)
regres2 <- lm(Ret.verde~Ret.ibov+Ret.snp+Ret.imab5+Ret.imab5p+
               Ret.dolar+Ret.di19+Ret.di23, data=jan2)
b2.hat<-coef(regres2) #coeficientes
regres2.hat<-fitted(regres2) #retorno previsto
u2.hat<-resid(regres2) #residuos
summary(regres2)

## Regressão da janela 3 (2020)
regres3 <- lm(Ret.verde~Ret.ibov+Ret.snp+Ret.imab5+Ret.imab5p+
               Ret.dolar+Ret.di21+Ret.di25, data=jan3)
b3.hat<-coef(regres3) #coeficientes
regres3.hat<-fitted(regres3) #retorno previsto
u3.hat<-resid(regres3) #residuos
summary(regres3)
```

As hipóteses de Gauss-Markov para que o método de OLS seja não viesado são:

#### 4.2 Média Condicional Zero

O erro $\mu$ tem um valor esperado igual a zero, dados quaisquer valores das variáveis independentes. Em formula $E(\mu|F_1, F_2,...,F_7)$.

#### 4.3 Amostra Aleatória (iid)

Assumimos que nossa amostra é aleatória e independente. Segundo Cochrane, o preço de um ativo é dado por p_t+1 =p_t +ε_t+1, ou seja, se σ2(ε )=constante os preços seguem um "random walk". Essa definição é amplamente utilizada na teoria de finanças tradicionais e quer dizer que, se os mercados financeiros são eficientes, o preço de amanhã deve ser explicado pelo preço de hoje (que reflete toda a informação disponível sobre esse ativo) mais um choque imprevisível. Intuitivamente, se o preço hoje está muito menor que o preço de amanhã, os agentes vão antecipar esse aumento de preço e tentar comprar esse ativo, levando a um aumento de preço hoje e não amanhã. Sendo assim, os retornos de um ativo devem ser tão imprevisíveis como jogar uma moeda.

#### 4.4 Multicolinearidade não-perfeita

A hipóteses RLM.3 Colinearidade não perfeita diz:
 “Na amostra (e, portanto, na população) nenhuma das variáveis independentes é constante, e não há relações lineares exatas entre as variáveis independentes”
 
A continuação vemos, para cada janela de tempo (1, 2 e 3), que as correlações entre as variáveis independentes não são perfeitas, por tanto não há relações lineares entre elas.

$\underline{Testando\space as\space propiedades\space algebraicas:}$

```{r rlm.4, echo = F, eval = T, include = F}

#media do residuo janela 1

muhat1 = mean(u1.hat)

#media do residuo janela 2

muhat2 = mean(u2.hat)

#media do residuo janela 3

muhat3 = mean(u3.hat)
```

* Propriedade 1: $E(\hat{\mu}|F_1, F_2,...,F_7)$
Os valores esperados dos resíduos da Janela 1, 2 e 3 são:

* *$E(\hat{\mu_1})$ = `r muhat1`*

* *$E(\hat{\mu_2})$ = `r muhat2`*

* *$E(\hat{\mu_3})$ = `r muhat3`*

Podemos observar que os valores esperados dos resíduos para as três janelas de tempo estão muito perto de zero e por tanto a hipóteses de média condicional zero é cumprida.


* Propriedade 2: $cov(F_j, \hat{\mu}) = 0$

```{r rlm.5, echo = F, eval = T, include = F}

#correlacao das clases com o residuo janela 1

cov1 = cbind(cov(jan1$Ret.ibov, u1.hat), cov(jan1$Ret.snp, u1.hat), cov(jan1$Ret.imab5, u1.hat), cov(jan1$Ret.imab5p, u1.hat), cov(jan1$Ret.dolar, u1.hat), cov(jan1$Ret.di17, u1.hat), cov(jan1$Ret.di21, u1.hat))

#media do residuo janela 2

cov2 = cbind(cov(jan2$Ret.ibov, u2.hat), cov(jan2$Ret.snp, u2.hat), cov(jan2$Ret.imab5, u2.hat), cov(jan2$Ret.imab5p, u2.hat), cov(jan2$Ret.dolar, u2.hat), cov(jan2$Ret.di19, u2.hat), cov(jan2$Ret.di23, u2.hat))

#media do residuo janela 3

cov3 = cbind(cov(jan3$Ret.ibov, u3.hat), cov(jan3$Ret.snp, u3.hat), cov(jan3$Ret.imab5, u3.hat), cov(jan3$Ret.imab5p, u3.hat), cov(jan3$Ret.dolar, u3.hat), cov(jan3$Ret.di21, u3.hat), cov(jan3$Ret.di25, u3.hat))
```

**Janela 1:**

**Fator j**|**$Cov(F_j, \hat{\mu_j})$**
-------|-------
ret.ibov| `r cov1[,1]`
ret.snp| `r cov1[,2]`
ret.imab5| `r cov1[,3]`
ret.imab5p| `r cov1[,4]`
ret.dolar| `r cov1[,5]`
ret.di17| `r cov1[,6]`
ret.di21| `r cov1[,7]`

**Janela 2:**

**Fator j**|**$cov(F_j, \hat{\mu_j})$**
-------|-------
ret.ibov| `r cov2[,1]`
ret.snp| `r cov2[,2]`
ret.imab5| `r cov2[,3]`
ret.imab5p| `r cov2[,4]`
ret.dolar| `r cov2[,5]`
ret.di17| `r cov2[,6]`
ret.di21| `r cov2[,7]`

**Janela 3:**

**Fator j**|**$cov(F_j, \hat{\mu_j})$**
-------|-------
ret.ibov| `r cov3[,1]`
ret.snp| `r cov3[,2]`
ret.imab5| `r cov3[,3]`
ret.imab5p| `r cov3[,4]`
ret.dolar| `r cov3[,5]`
ret.di17| `r cov3[,6]`
ret.di21| `r cov3[,7]`

Podemos observar que todos os valores estão perto do zero, pelo qual assumimos que as hipóteses são verdadeiras.

* Propriedade 3: O ponto $(\tilde{F_1}, \tilde{F_2}, ..., \tilde{F_7})$ esta sempre sobre a reta de regressão de OLS $\tilde{R} = \tilde{F_1} + \tilde{F_2} + ... + \tilde{F_7}$

|**Janela 1**|**Janela 2**|**Janela 3**
-----|-----|-----|-----
$Fitted\space Value =$| `r mean(fitted(regres1))`| `r mean(fitted(regres2))`| `r mean(fitted(regres3))`
$\bar{Y}=$| `r mean(jan1$Ret.verde)`| `r mean(jan2$Ret.verde)`| `r mean(jan3$Ret.verde)`


Também podemos observar que as correlações entre as variáveis independentes não são perfeitas:

**Matriz de correlacoes entre os fatores Janela 1:**

Fator| Ret.ibov| Ret.snp| Ret.imab5| Ret.imab5p|Ret.dolar|Ret.di17|Ret.di21
------------- | -------------| -------------| -------------| -------------| -------------| -------------| -------------
Ret.ibov | `r  cor(jan1$Ret.ibov, jan1$Ret.ibov)`|`r  cor(jan1$Ret.ibov, jan1$Ret.snp)`|`r  cor(jan1$Ret.ibov, jan1$Ret.imab5)`|`r  cor(jan1$Ret.ibov, jan1$Ret.imab5p)`|`r  cor(jan1$Ret.ibov, jan1$Ret.dolar)`|`r  cor(jan1$Ret.ibov, jan1$Ret.di17)`|`r  cor(jan1$Ret.ibov, jan1$Ret.di21)`
Ret.snp | `r  cor(jan1$Ret.snp, jan1$Ret.ibov)`|`r  cor(jan1$Ret.snp, jan1$Ret.snp)`|`r  cor(jan1$Ret.snp, jan1$Ret.imab5)`|`r  cor(jan1$Ret.snp, jan1$Ret.imab5p)`|`r  cor(jan1$Ret.snp, jan1$Ret.dolar)`|`r  cor(jan1$Ret.snp, jan1$Ret.di17)`|`r  cor(jan1$Ret.snp, jan1$Ret.di21)`
Ret.imab5 | `r  cor(jan1$Ret.imab5, jan1$Ret.ibov)`|`r  cor(jan1$Ret.imab5, jan1$Ret.snp)`|`r  cor(jan1$Ret.imab5, jan1$Ret.imab5)`|`r  cor(jan1$Ret.imab5, jan1$Ret.imab5p)`|`r  cor(jan1$Ret.imab5, jan1$Ret.dolar)`|`r  cor(jan1$Ret.imab5, jan1$Ret.di17)`|`r  cor(jan1$Ret.imab5, jan1$Ret.di21)`
Ret.imab5p | `r  cor(jan1$Ret.imab5p, jan1$Ret.ibov)`|`r  cor(jan1$Ret.imab5p, jan1$Ret.snp)`|`r  cor(jan1$Ret.imab5p, jan1$Ret.imab5)`|`r  cor(jan1$Ret.imab5p, jan1$Ret.imab5p)`|`r  cor(jan1$Ret.imab5p, jan1$Ret.dolar)`|`r  cor(jan1$Ret.imab5p, jan1$Ret.di17)`|`r  cor(jan1$Ret.imab5p, jan1$Ret.di21)`
Ret.dolar | `r  cor(jan1$Ret.dolar, jan1$Ret.ibov)`|`r  cor(jan1$Ret.dolar, jan1$Ret.snp)`|`r  cor(jan1$Ret.dolar, jan1$Ret.imab5)`|`r  cor(jan1$Ret.dolar, jan1$Ret.imab5p)`|`r  cor(jan1$Ret.dolar, jan1$Ret.dolar)`|`r  cor(jan1$Ret.dolar, jan1$Ret.di17)`|`r  cor(jan1$Ret.dolar, jan1$Ret.di21)`
Ret.di17 | `r  cor(jan1$Ret.di17, jan1$Ret.ibov)`|`r  cor(jan1$Ret.di17, jan1$Ret.snp)`|`r  cor(jan1$Ret.di17, jan1$Ret.imab5)`|`r  cor(jan1$Ret.di17, jan1$Ret.imab5p)`|`r  cor(jan1$Ret.di17, jan1$Ret.dolar)`|`r  cor(jan1$Ret.di17, jan1$Ret.di17)`|`r  cor(jan1$Ret.di17, jan1$Ret.di21)`
Ret.di21 | `r  cor(jan1$Ret.di21, jan1$Ret.ibov)`|`r  cor(jan1$Ret.di21, jan1$Ret.snp)`|`r  cor(jan1$Ret.di21, jan1$Ret.imab5)`|`r  cor(jan1$Ret.di21, jan1$Ret.imab5p)`|`r  cor(jan1$Ret.di21, jan1$Ret.dolar)`|`r  cor(jan1$Ret.di21, jan1$Ret.di17)`|`r  cor(jan1$Ret.di21, jan1$Ret.di21)`

**Matriz de correlacoes entre os fatores Janela 2:**

Fator| Ret.ibov| Ret.snp| Ret.imab5| Ret.imab5p|Ret.dolar|Ret.di19|Ret.di23
------------- | -------------| -------------| -------------| -------------| -------------| -------------| -------------
Ret.ibov | `r  cor(jan2$Ret.ibov, jan2$Ret.ibov)`|`r  cor(jan2$Ret.ibov, jan2$Ret.snp)`|`r  cor(jan2$Ret.ibov, jan2$Ret.imab5)`|`r  cor(jan2$Ret.ibov, jan2$Ret.imab5p)`|`r  cor(jan2$Ret.ibov, jan2$Ret.dolar)`|`r  cor(jan2$Ret.ibov, jan2$Ret.di19)`|`r  cor(jan2$Ret.ibov, jan2$Ret.di23)`
Ret.snp | `r  cor(jan2$Ret.snp, jan2$Ret.ibov)`|`r  cor(jan2$Ret.snp, jan2$Ret.snp)`|`r  cor(jan2$Ret.snp, jan2$Ret.imab5)`|`r  cor(jan2$Ret.snp, jan2$Ret.imab5p)`|`r  cor(jan2$Ret.snp, jan2$Ret.dolar)`|`r  cor(jan2$Ret.snp, jan2$Ret.di19)`|`r  cor(jan2$Ret.snp, jan2$Ret.di23)`
Ret.imab5 | `r  cor(jan2$Ret.imab5, jan2$Ret.ibov)`|`r  cor(jan2$Ret.imab5, jan2$Ret.snp)`|`r  cor(jan2$Ret.imab5, jan2$Ret.imab5)`|`r  cor(jan2$Ret.imab5, jan2$Ret.imab5p)`|`r  cor(jan2$Ret.imab5, jan2$Ret.dolar)`|`r  cor(jan2$Ret.imab5, jan2$Ret.di19)`|`r  cor(jan2$Ret.imab5, jan2$Ret.di23)`
Ret.imab5p | `r  cor(jan2$Ret.imab5p, jan2$Ret.ibov)`|`r  cor(jan2$Ret.imab5p, jan2$Ret.snp)`|`r  cor(jan2$Ret.imab5p, jan2$Ret.imab5)`|`r  cor(jan2$Ret.imab5p, jan2$Ret.imab5p)`|`r  cor(jan2$Ret.imab5p, jan2$Ret.dolar)`|`r  cor(jan2$Ret.imab5p, jan2$Ret.di19)`|`r  cor(jan2$Ret.imab5p, jan2$Ret.di23)`
Ret.dolar | `r  cor(jan2$Ret.dolar, jan2$Ret.ibov)`|`r  cor(jan2$Ret.dolar, jan2$Ret.snp)`|`r  cor(jan2$Ret.dolar, jan2$Ret.imab5)`|`r  cor(jan2$Ret.dolar, jan2$Ret.imab5p)`|`r  cor(jan2$Ret.dolar, jan2$Ret.dolar)`|`r  cor(jan2$Ret.dolar, jan2$Ret.di19)`|`r  cor(jan2$Ret.dolar, jan2$Ret.di23)`
Ret.di19 | `r  cor(jan2$Ret.di19, jan2$Ret.ibov)`|`r  cor(jan2$Ret.di19, jan2$Ret.snp)`|`r  cor(jan2$Ret.di19, jan2$Ret.imab5)`|`r  cor(jan2$Ret.di19, jan2$Ret.imab5p)`|`r  cor(jan2$Ret.di19, jan2$Ret.dolar)`|`r  cor(jan2$Ret.di19, jan2$Ret.di19)`|`r  cor(jan2$Ret.di19, jan2$Ret.di23)`
Ret.di23 | `r  cor(jan2$Ret.di23, jan2$Ret.ibov)`|`r  cor(jan2$Ret.di23, jan2$Ret.snp)`|`r  cor(jan2$Ret.di23, jan2$Ret.imab5)`|`r  cor(jan2$Ret.di23, jan2$Ret.imab5p)`|`r  cor(jan2$Ret.di23, jan2$Ret.dolar)`|`r  cor(jan2$Ret.di23, jan2$Ret.di19)`|`r  cor(jan2$Ret.di23, jan2$Ret.di23)`

**Matriz de correlacoes entre os fatores Janela 3:**

Fator| Ret.ibov| Ret.snp| Ret.imab5| Ret.imab5p|Ret.dolar|Ret.di21|Ret.di25
------------- | -------------| -------------| -------------| -------------| -------------| -------------| -------------
Ret.ibov | `r  cor(jan3$Ret.ibov, jan3$Ret.ibov)`|`r  cor(jan3$Ret.ibov, jan3$Ret.snp)`|`r  cor(jan3$Ret.ibov, jan3$Ret.imab5)`|`r  cor(jan3$Ret.ibov, jan3$Ret.imab5p)`|`r  cor(jan3$Ret.ibov, jan3$Ret.dolar)`|`r  cor(jan3$Ret.ibov, jan3$Ret.di21)`|`r  cor(jan3$Ret.ibov, jan3$Ret.di25)`
Ret.snp | `r  cor(jan3$Ret.snp, jan3$Ret.ibov)`|`r  cor(jan3$Ret.snp, jan3$Ret.snp)`|`r  cor(jan3$Ret.snp, jan3$Ret.imab5)`|`r  cor(jan3$Ret.snp, jan3$Ret.imab5p)`|`r  cor(jan3$Ret.snp, jan3$Ret.dolar)`|`r  cor(jan3$Ret.snp, jan3$Ret.di21)`|`r  cor(jan3$Ret.snp, jan3$Ret.di25)`
Ret.imab5 | `r  cor(jan3$Ret.imab5, jan3$Ret.ibov)`|`r  cor(jan3$Ret.imab5, jan3$Ret.snp)`|`r  cor(jan3$Ret.imab5, jan3$Ret.imab5)`|`r  cor(jan3$Ret.imab5, jan3$Ret.imab5p)`|`r  cor(jan3$Ret.imab5, jan3$Ret.dolar)`|`r  cor(jan3$Ret.imab5, jan3$Ret.di21)`|`r  cor(jan3$Ret.imab5, jan3$Ret.di25)`
Ret.imab5p | `r  cor(jan3$Ret.imab5p, jan3$Ret.ibov)`|`r  cor(jan3$Ret.imab5p, jan3$Ret.snp)`|`r  cor(jan3$Ret.imab5p, jan3$Ret.imab5)`|`r  cor(jan3$Ret.imab5p, jan3$Ret.imab5p)`|`r  cor(jan3$Ret.imab5p, jan3$Ret.dolar)`|`r  cor(jan3$Ret.imab5p, jan3$Ret.di21)`|`r  cor(jan3$Ret.imab5p, jan3$Ret.di25)`
Ret.dolar | `r  cor(jan3$Ret.dolar, jan3$Ret.ibov)`|`r  cor(jan3$Ret.dolar, jan3$Ret.snp)`|`r  cor(jan3$Ret.dolar, jan3$Ret.imab5)`|`r  cor(jan3$Ret.dolar, jan3$Ret.imab5p)`|`r  cor(jan3$Ret.dolar, jan3$Ret.dolar)`|`r  cor(jan3$Ret.dolar, jan3$Ret.di21)`|`r  cor(jan3$Ret.dolar, jan3$Ret.di25)`
Ret.di21 | `r  cor(jan3$Ret.di21, jan3$Ret.ibov)`|`r  cor(jan3$Ret.di21, jan3$Ret.snp)`|`r  cor(jan3$Ret.di21, jan3$Ret.imab5)`|`r  cor(jan3$Ret.di21, jan3$Ret.imab5p)`|`r  cor(jan3$Ret.di21, jan3$Ret.dolar)`|`r  cor(jan3$Ret.di21, jan3$Ret.di21)`|`r  cor(jan3$Ret.di21, jan3$Ret.di25)`
Ret.di25 | `r  cor(jan3$Ret.di25, jan3$Ret.ibov)`|`r  cor(jan3$Ret.di25, jan3$Ret.snp)`|`r  cor(jan3$Ret.di25, jan3$Ret.imab5)`|`r  cor(jan3$Ret.di25, jan3$Ret.imab5p)`|`r  cor(jan3$Ret.di25, jan3$Ret.dolar)`|`r  cor(jan3$Ret.di25, jan3$Ret.di21)`|`r  cor(jan3$Ret.di25, jan3$Ret.di25)`

#### 4.5 Homocedasticidade


### Report Results

### Conclusão

